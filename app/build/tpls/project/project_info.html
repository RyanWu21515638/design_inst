<div class="main-container" style="padding-left: 2%;border: 1px solid lightgrey;" ng-controller="projectCtrl">
    <div class="main-container-inner">
        <div class="page-content">
            <div class="page-header visible-lg visible-md visible-sm">
                <h3>
                    <b>项目列表</b>
                </h3>
            </div>
            <form class="form-horizontal" role="form">
                <div class="form-group visible-lg visible-md visible-sm" style=" margin-left: 2%;">
                    <label class="col-xs-3" style="text-align: right;"> 总项目查询： </label>
                    <div class="col-xs-6">
                        <input placeholder="请输入总项目名称或者创建者查询" ng-model="query" style="width: 50%;margin-right: 10px;"/>
                    </div>
                    <div class="col-xs-3 visible-lg visible-md visible-sm" ng-if="userinfo.status == '2'">
                        <button type="button" class="btn btn-primary btn-sm right" data-toggle="modal"
                                data-target="#modal-form1" ng-click="newprjJuge();configurationlist();">
                            新建总项目
                        </button>
                    </div>
                </div>
                <div class="space-6"></div>


                <!--<div class="visible-xs" style="margin-top: 2%;">
                    <label class="col-xs-3" style="text-align: right;"> 总项目查询： </label>
                    <div class="col-xs-12">
                        <input placeholder="请输入总项目名称查询" ng-model="query" style="width: 50%;margin-right: 10px;"/>
                        &lt;!&ndash; 与我有关<input type="checkbox" style="margin-left: 10px;" >&ndash;&gt;
                    </div>
                    <div class="col-xs-3 visible-lg visible-md">
                        <button type="button" class="btn btn-primary btn-sm right" data-toggle="modal"
                                data-target="#modal-form1" ng-click="reset()">
                            新建总项目
                        </button>
                    </div>
                </div>-->
                <div class="visible-xs col-xs-12" style="margin-top: 10px;margin-bottom: 10px;">
                    <div class="list-group" ng-repeat="x in prj_list | filter:query"
                         ng-click="prj_dt($index,x.project_id,2)"
                         style="font-size: 20px;text-align: center;padding: 10px;margin-bottom: 0;">

                        <a class="list-group-item">{{x.name}}</a>
                    </div>
                </div>

                <div id="prj_tab" class="table-responsive animated bounceInRight visible-lg visible-md visible-sm"
                     style="overflow-x: auto; overflow-y: auto; height:300px;">

                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th colspan="6">总项目列表</th>
                        </tr>
                        <tr>
                            <th width="40%">名称</th>
                            <th width="6%">创建者</th>
                            <th width="12%">计划开始时间</th>
                            <th width="12%">计划结束时间</th>
                            <th width="10%">状态</th>
                            <th width="18%" style="text-align: center;" ng-if="userinfo.status == '2'">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="x in prj_list | filter:query" ng-click="prj_dt($index,x.project_id,1)"
                            data-toggle="popover" title="点击查看子项目列表">
                            <td>{{x.name}}</td>
                            <td>{{x.creator_nickname}}</td>
                            <td>{{x.start_time_plan}}</td>
                            <td>{{x.end_time_plan}}</td>
                            <td ng-if="x.state == 1">已立项</td>
                            <td ng-if="x.state == 2">已归档</td>
                            <th ng-if="userinfo.status == '2'" style="text-align: center;">
                                <button class="btn-primary" href="" data-toggle="modal"
                                        data-target="#modal-form2">新建子项目
                                </button>
                                <button class="btn-default" ng-click="delProject(x.project_id)" href="">
                                    <a style="color: red">
                                        <span class="icon-trash bigger-130"></span>
                                    </a>
                                </button>
                                </th>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="table-responsive animated bounceInRight visible-lg visible-md visible-sm"
                     style="overflow-x: auto; overflow-y: auto; height:300px;">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th colspan="9">子项目列表</th>
                        </tr>
                        <tr>
                            <th width="5%" class="text-center">No.</th>
                            <th width="16%">子项目名称</th>
                            <th width="12%">计划开始时间</th>
                            <th width="12%">计划结束时间</th>
                            <th width="12%">实际开始时间</th>
                            <th width="12%">实际结束时间</th>
                            <th width="20%">状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="x in prj_list[index].subproject_list | filter:query"
                            ng-click="subchose(x.subproject_id)"
                            ng-dblclick="dbclick($index)"
                            data-toggle="popover" title="点击项目名称查看任务详情">
                            <td style="text-align: center;">{{$index+1}}</td>
                            <td>
                                <a ui-sref="index.project.subproject_info_detail({prj_id:prjinfo.prj_id,subprj_id:rolesinfo.subprj_id})"
                                   ng-click="set_prj_suprj_name(x.subproject_id)">{{x.name}}</a>
                            </td>
                            <td>{{x.start_time_plan}}</td>
                            <td>
                                <label data-toggle="popover" title="项目告急！请快马加鞭" class="label label-danger" ng-if="x.D_value <= 3">{{x.end_time_plan}}</label>
                                <label data-toggle="popover" title="领导在催了！" class="label label-warning" ng-if="x.D_value <= 3 && x.D_value>5">{{x.end_time_plan}}</label>
                                <label data-toggle="popover" title="细心点，慢慢来喝杯茶，还有时间！" class="label label-default" ng-if="x.D_value >= 6">{{x.end_time_plan}}</label></td>
                            <td>{{x.start_time_real}}</td>
                            <td>{{x.end_time_real}}</td>
                            <td ng-if="x.state == 1">已立项，底图待深化</td>
                            <td ng-if="x.state == 2">底图已深化。底图深化待审核</td>
                            <td ng-if="x.state == 3">底图深化已审核，待设计</td>
                            <td ng-if="x.state == 4">设计已完成，待审核</td>
                            <td ng-if="x.state == 5">设计审核通过，待下单</td>
                            <td ng-if="x.state == 6">项目已归档</td>
                            <th><a href="" style="color: red;" ng-click="downloadList(x.subproject_id)"
                                   data-toggle="modal"
                                   data-target="#modal-form4">成果下载</a>
                                <a href="" data-toggle="modal" ng-click="grouplist()"
                                   data-target="#modal-form3" ng-if="userinfo.status == '2'">详情</a>
                                <a style="color: red" ng-click="delSubproject(x.subproject_id)" href=""
                                   ng-if="userinfo.status == '2'">
                                    <span class="icon-trash bigger-130"></span>
                                </a></th>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="modal-form1" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog" style="width:30%;margin-top: 8%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">新建总项目</h2>
                            </div>

                            <div class="modal-body overflow-visible">
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">总项目名称:</label>
                                    <input class="col-sm-5" placeholder="请输入项目名称"
                                           ng-model="prjinfo.prjname" required/>
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划开始时间:</label>
                                    <input size="16" value={{t1.year}}-{{t1.month}}-{{t1.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker1">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划结束时间:</label>
                                    <input size="16" value={{t2.year}}-{{t2.month}}-{{t2.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker2">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">选择配置:</label>
                                    <select class="col-sm-5"
                                            ng-model="prjinfo.config_id"
                                            ng-options="dp.id as dp.name for dp in conf_list"
                                            required>
                                        <option value="">-- 请选择项目配置 --</option>
                                    </select>
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">创建子项目:</label>
                                    <input type="checkbox" ng-model="prjinfo.create_sub">
                                </div>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-success col-sm-offset-4" ng-click="newprj()">创建</button>
                                <button class="btn btn-danger" data-dismiss="modal">返回</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-form2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:30%;margin-top: 8%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">创建子项目</h2>
                            </div>

                            <div class="modal-body overflow-visible">
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">子项目名称:</label>
                                    <input class="col-sm-5" placeholder="请输入项目名称"
                                           ng-model="subprjinfo.subprjname" required/>
                                </div>

                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划开始时间:</label>
                                    <input size="16" value={{t5.year}}-{{t5.month}}-{{t5.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker5">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划结束时间:</label>
                                    <input size="16" value={{t6.year}}-{{t6.month}}-{{t6.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker6">
                                </div>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-success col-sm-offset-3" ng-click="newsubprj()">创建子项目</button>
                                <button class="btn btn-danger">清空</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-form3" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:80%;margin-top: 4%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">人员和权限分配信息</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="10">已分配的人员和权限</th>
                                        </tr>
                                        <tr>
                                            <th width="25px;" class="center">No.</th>
                                            <th width="100px">姓名</th>
                                            <th ng-repeat="x in grp_list">
                                                {{x.name}}
                                            </th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in prj_role_list | filter:query" ng-click="ngtest($index)"
                                            ng-dblclick="dbclick($index)">
                                            <td style="text-align: center;">{{$index+1}}</td>
                                            <td>{{x.nickname}}</td>
                                            <td class="center" ng-repeat="y in prj_role_list[$index].roles">
                                                <i ng-if="y != 'false'" class="icon-ok bigger-140 green"
                                                   style="color: green"></i>
                                                <i ng-if="y == 'false'" class="icon-remove bigger-140 red"
                                                   style="color: red"></i>
                                            </td>
                                            <th>
                                                <button ng-click="remove(x.openid)">移除</button>
                                            </th>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                                    <div class="table-responsive"
                                         style="overflow-x: auto; overflow-y: auto; height:200px;">
                                        <table class="table table-striped table-bordered table-hover">
                                            <thead>
                                            <tr>
                                                <th colspan="10">剩余可分配的人员列表</th>
                                            </tr>
                                            <tr>
                                                <th width="25px" class="center">No.</th>
                                                <th width="100px">姓名</th>
                                                <th ng-repeat="x in grp_list">
                                                    {{x.name}}
                                                </th>
                                                <th>操作</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="x in usr_list | filter:query" ng-click="peopleDetail($index,x.nickname)"
                                                ng-if="x.show == true">
                                                    <td style="text-align: center;">{{$index+1}}</td>
                                                    <td>{{ x.nickname}}</td>
                                                    <td><input type="checkbox" ng-model="x.check[0]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[1]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[2]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[3]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[4]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[5]" ></td>
                                                    <td><input type="checkbox" ng-model="x.check[6]" ></td>
                                                    <td>
                                                        <button type="submit" ng-click="hide($index)">添加</button>
                                                    </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="10">剩余可分配的人员<label style="color:red;">{{people_detail_name}}</label>所参与的项目信息
                                            </th>
                                        </tr>
                                        <tr>
                                            <th >项目名称</th>
                                            <th >参与具体任务</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in usr_list[people_detail_index].projectlist | filter:query">
                                                <td class="center">{{x.sub_name}}</td>
                                                <td><label ng-repeat="y in x.task_name">
                                                    -{{y.name}}-
                                                </label></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                            <!--<div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">其它信息</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-xs-2 col-xs-offset-2">计划开始时间:</label>
                                    <input size="16" value={{t3.year}}-{{t3.month}}-{{t3.day}}
                                           readonly class="col-md-4"
                                           id="timepicker3">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-xs-2 col-xs-offset-2">计划结束时间:</label>
                                    <input size="16" value={{t4.year}}-{{t4.month}}-{{t4.day}}
                                           readonly class="col-md-4"
                                           id="timepicker4">
                                    <button>保存</button>
                                </div>
                            </div>-->
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-primary col-xs-2 col-xs-offset-10" data-dismiss="modal">完成
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-form4" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel4"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:40%;margin-top: 4%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">项目文件</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="9"></th>
                                        </tr>
                                        <tr>
                                            <th class="center">No.</th>
                                            <th>文件名</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in dl_list.prj_file | filter:query">
                                            <td>{{$index+1}}</td>
                                            <td><a href="{{x.file}}" download="{{x.filename}}">{{x.filename}}</a></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">配置文件</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <table class="table table-striped table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th colspan="9"></th>
                                    </tr>
                                    <tr>
                                        <th class="center">No.</th>
                                        <th>文件名</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="x in dl_list.prj_conf | filter:query">
                                        <td>{{$index+1}}</td>
                                        <td><a href="{{x.file}}" download="{{x.filename}}">{{x.filename}}</a></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-primary col-lg-2 col-lg-offset-10" data-dismiss="modal">完成
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div><!--pagecontent-->
    </div><!-- main-container-inner-->
</div>



