<div class="main-container" style="padding-left: 2%;border: 1px solid lightgrey;" ng-controller="projectCtrl">
    <div class="main-container-inner">
        <div class="page-content">
            <div class="page-header visible-lg visible-md visible-sm">
                <h3>
                    <b>项目列表</b>
                </h3>
            </div>
            <form class="form-horizontal" role="form">
                <div class="form-group visible-lg visible-md visible-sm" style=" margin-left: 2%;">
                    <label class="col-xs-3" style="text-align: right;"> 总项目查询： </label>
                    <div class="col-xs-6">
                        <input placeholder="请输入总项目名称或者创建者查询" ng-model="query" style="width: 50%;margin-right: 10px;"/>
                    </div>
                    <div class="col-xs-3 visible-lg visible-md visible-sm" ng-if="userinfo.status == '2'">
                        <button type="button" class="btn btn-primary right" data-toggle="modal"
                                data-target="#modal-form1" ng-click="newprjJuge();configurationlist();">
                            新建总项目
                        </button>
                    </div>
                </div>
                <div class="space-6"></div>


                <!--<div class="visible-xs" style="margin-top: 2%;">
                    <label class="col-xs-3" style="text-align: right;"> 总项目查询： </label>
                    <div class="col-xs-12">
                        <input placeholder="请输入总项目名称查询" ng-model="query" style="width: 50%;margin-right: 10px;"/>
                        &lt;!&ndash; 与我有关<input type="checkbox" style="margin-left: 10px;" >&ndash;&gt;
                    </div>
                    <div class="col-xs-3 visible-lg visible-md">
                        <button type="button" class="btn btn-primary btn-sm right" data-toggle="modal"
                                data-target="#modal-form1" ng-click="reset()">
                            新建总项目
                        </button>
                    </div>
                </div>-->
                <div class="visible-xs col-xs-12" style="margin-top: 10px;margin-bottom: 10px;">
                    <div class="row" style="text-align: center;">
                        <label class="label label-primary" >总项目列表</label>
                    </div>

                    <div class="list-group" ng-repeat="x in prj_list | filter:query"
                         ng-click="prj_dt(x.project_id,2)"
                         style="font-size: 20px;text-align: center;padding: 10px;margin-bottom: 0;">

                        <a class="list-group-item">{{x.name}}
                            <label ng-if="x.state == 1">
                                <span class="label label-warning">已立项</span></label>
                            <label ng-if="x.state == 2">
                                <span class="label label-success">已归档</span></label></a>
                    </div>
                </div>

                <div id="prj_tab" class="table-responsive animated bounceInRight visible-lg visible-md visible-sm"
                     style="overflow-x: auto; overflow-y: auto; height:300px;">

                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th colspan="6">总项目列表</th>
                        </tr>
                        <tr style="background: #E9E9E9">
                            <th width="36%">名称</th>
                            <th width="10%">创建者

                            </th>
                            <th width="12%">计划开始时间</th>
                            <th width="12%">计划结束时间</th>
                            <th width="15%">状态</th>
                            <th ng-if="userinfo.status == '2'">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="x in prj_list | filter:query" ng-click="prj_dt(x.project_id,1)"
                            data-toggle="popover" title="点击查看子项目列表">
                            <td>{{x.name}}</td>
                            <td>
                                <img src="{{x.headimgurl}}"
                                     style="height: 20px;width: 20px;border-radius: 50%;">
                                <label>{{x.creator_nickname}}</label>

                            </td>

                            <td>{{x.start_time_plan}}</td>
                            <td>{{x.end_time_plan}}</td>
                            <td ng-if="x.state == 1">
                                <span class="label label-warning">已立项</span></td>
                            <td ng-if="x.state == 2">
                                <span class="label label-success">已归档</span></td>
                            <th ng-if="userinfo.status == '2'" >

                                <div class="dropdown">
                                    <label type="button" class="btn-xs label-primary dropdown-toggle"
                                           id="dropdownMenu2" style="color: white;"
                                            data-toggle="dropdown">
                                        <span class="caret"></span>
                                    </label>
                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                                        <li role="presentation" >
                                            <a href="" data-toggle="modal"
                                                    data-target="#modal-form2">新建子项目
                                            </a>
                                        </li>
                                        <li role="presentation">
                                            <a data-toggle="modal"
                                               data-target="#modal-delete"
                                               ng-click="delProject(x.project_id,x.name,1)" href="" style="color: red">
                                                删除<span class="icon-trash bigger-130" style="margin-left: 5px;"></span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>

                            </th>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="table-responsive animated bounceInRight visible-lg visible-md visible-sm"
                     style="overflow-x: auto; overflow-y: auto; height:300px;">
                    <table class="table table-striped table-hover">
                        <thead>
                        <tr>
                            <th colspan="9">子项目列表</th>
                        </tr>
                        <tr style="background: #E9E9E9">
                            <th width="5%" class="text-center">No.</th>
                            <th width="16%">子项目名称</th>
                            <th width="12%">计划开始时间</th>
                            <th width="12%">计划结束时间</th>
                            <th width="12%">实际开始时间</th>
                            <th width="12%">实际结束时间</th>
                            <th width="20%">状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="x in prj_list[index].subproject_list"
                            ng-click="subchose(x.subproject_id,x.state)"
                            ng-dblclick="dbclick($index)"
                            data-toggle="popover" title="点击项目名称查看任务详情">
                            <td style="text-align: center;">{{$index+1}}</td>
                            <td>
                                <label class="label-default" style="cursor:pointer;" ng-if="fromIPM == 'true'"
                                       ng-click="set_prj_suprj_name(x.subproject_id)">{{x.name}}</label>
                                <label class="label label-default" style="cursor:pointer;" ng-if="fromIPM != 'true'"
                                       ui-sref="index.project.subproject_info_detail({prj_id:prjinfo.prj_id,subprj_id:rolesinfo.subprj_id})"
                                       ng-click="set_prj_suprj_name(x.subproject_id)">{{x.name}}</label>
                            </td>
                            <td>{{x.start_time_plan}}</td>
                            <td>
                                <label data-toggle="popover" title="项目告急！请快马加鞭" class="label label-danger"
                                       ng-if="x.D_value <= 3">{{x.end_time_plan}}</label>
                                <label data-toggle="popover" title="领导在催了！" class="label label-warning"
                                       ng-if="x.D_value <= 3 && x.D_value>5">{{x.end_time_plan}}</label>
                                <label data-toggle="popover" title="细心点，慢慢来喝杯茶，还有时间！" class="label label-default"
                                       ng-if="x.D_value >= 6">{{x.end_time_plan}}</label></td>
                            <td>{{x.start_time_real}}</td>
                            <td>{{x.end_time_real}}</td>
                            <td ng-if="x.state == 1"><span class="label label-warning">项目已立项，底图待深化</span></td>
                            <td ng-if="x.state == 2"><span class="label label-primary">底图已深化，底图深化待审核</span></td>
                            <td ng-if="x.state == 3"><span class="label label-info">底图深化已审核，待标准层下单</span></td>
                            <td ng-if="x.state == 4"><span class="label label-danger">标准层已下单,待变化层下单</span></td>
                            <td ng-if="x.state == 5"><span class="label label-default">变化层已下单，待归档</span></td>
                            <td ng-if="x.state == 6"><span class="label label-success">项目已归档</span></td>
                            <th>
                                <div class="dropdown">
                                    <label type="button" class="btn-xs label-primary dropdown-toggle" id="dropdownMenu1"
                                            data-toggle="dropdown">

                                        <span class="caret"></span>
                                    </label>
                                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                        <li role="presentation" >
                                            <a href="" ng-click="downloadList(x.subproject_id)"
                                               data-toggle="modal"
                                               data-target="#modal-form4">成果下载</a>
                                        </li>
                                        <li role="presentation">
                                            <a href="" data-toggle="modal" ng-click="grouplist()"
                                               data-target="#modal-form3" ng-if="userinfo.status == '2'">详情</a>
                                        </li>
                                        <li role="presentation">
                                            <a style="color: red" data-toggle="modal"
                                               data-target="#modal-delete"
                                               ng-click="delSubproject(x.subproject_id,x.name,1)" href=""
                                               ng-if="userinfo.status == '2'">
                                                删除<span class="icon-trash bigger-130" style="margin-left: 5px;"></span>
                                            </a>
                                        </li>


                                    </ul>
                                </div>

                                <!--<a href="" style="color: red;" ng-click="downloadList(x.subproject_id)"
                                   data-toggle="modal"
                                   data-target="#modal-form4">成果下载</a>
                                <a href="" data-toggle="modal" ng-click="grouplist()"
                                   data-target="#modal-form3" ng-if="userinfo.status == '2'">详情</a>
                                <a style="color: red" data-toggle="modal"
                                   data-target="#modal-delete"
                                   ng-click="delSubproject(x.subproject_id,x.name,1)" href=""
                                   ng-if="userinfo.status == '2'">
                                    <span class="icon-trash bigger-130"></span>
                                </a>-->

                            </th>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="modal-form1" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog" style="width:30%;margin-top: 8%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">新建总项目</h2>
                            </div>

                            <div class="modal-body overflow-visible">
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">总项目名称:</label>
                                    <input class="col-sm-5" placeholder="请输入项目名称"
                                           ng-model="prjinfo.prjname" required/>
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划开始时间:</label>
                                    <input size="16" value={{t1.year}}-{{t1.month}}-{{t1.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker1">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划结束时间:</label>
                                    <input size="16" value={{t2.year}}-{{t2.month}}-{{t2.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker2">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">选择配置:</label>
                                    <select class="col-sm-5"
                                            ng-model="prjinfo.config_id"
                                            ng-options="dp.id as dp.name for dp in conf_list"
                                            required>
                                        <option value="">-- 请选择项目配置 --</option>
                                    </select>
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">创建子项目:</label>
                                    <input type="checkbox" ng-model="prjinfo.create_sub">
                                </div>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-success col-sm-offset-4" ng-click="newprj()">创建</button>
                                <button class="btn btn-danger" data-dismiss="modal">返回</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-form2" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:30%;margin-top: 8%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">创建子项目</h2>
                            </div>

                            <div class="modal-body overflow-visible">
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">子项目名称:</label>
                                    <input class="col-sm-5" placeholder="请输入项目名称"
                                           ng-model="subprjinfo.subprjname" required/>
                                </div>

                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划开始时间:</label>
                                    <input size="16" value={{t5.year}}-{{t5.month}}-{{t5.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker5">
                                </div>
                                <div class="row" style="padding-top: 2%">
                                    <label class="col-sm-4 col-sm-offset-1">计划结束时间:</label>
                                    <input size="16" value={{t6.year}}-{{t6.month}}-{{t6.day}}
                                           readonly class="col-sm-5"
                                           id="timepicker6">
                                </div>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-success col-sm-offset-3" ng-click="newsubprj()">创建子项目</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="modal-delete" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:30%;margin-top: 8%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">提示！</h2>
                            </div>

                            <div class="modal-body overflow-visible" style="text-align: center;">
                                <label style="font-size: 18px;">确认是否删除
                                    <label style="font-size: 24px;color: red;" ng-if="delete_type == '1'">{{delete_prj_name}}</label>
                                    <label style="font-size: 24px;color: red;" ng-if="delete_type == '2'">{{delete_subprj_name}}</label>？
                                </label>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-success col-sm-offset-3"
                                        ng-if="delete_type == '1'"
                                        ng-click="delProject(delete_prj_id,delete_prj_name,2)">删除
                                </button>
                                <button class="btn btn-success col-sm-offset-3"
                                        ng-if="delete_type == '2'"
                                        ng-click="delSubproject(delete_subprj_id,delete_subprj_name,2)">删除
                                </button>
                                <button class="btn btn-danger" data-dismiss="modal">返回</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="modal-form3" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:80%;margin-top: 4%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">人员和权限分配信息</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="10">已分配的人员和权限</th>
                                        </tr>
                                        <tr>
                                            <th width="25px;" class="center">No.</th>
                                            <th width="100px">姓名</th>
                                            <th ng-repeat="x in grp_list">
                                                {{x.name}}
                                            </th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in prj_role_list | filter:query" ng-click="ngtest($index)"
                                            ng-dblclick="dbclick($index)">
                                            <td style="text-align: center;">{{$index+1}}</td>
                                            <td>{{x.nickname}}
                                                <img class="pull-right" src="{{x.headimgurl}}"
                                                     style="height: 20px;width: 20px;border-radius: 50%;">
                                            </td>
                                            <td class="center" ng-repeat="y in prj_role_list[$index].roles">
                                                <i ng-if="y != 'false'" class="icon-ok bigger-140 green"
                                                   style="color: green"></i>
                                                <i ng-if="y == 'false'" class="icon-remove bigger-140 red"
                                                   style="color: red"></i>
                                            </td>
                                            <th>
                                                <button ng-click="remove(x.openid)">移除</button>
                                            </th>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="10">剩余可分配的人员列表</th>
                                        </tr>
                                        <tr>
                                            <th width="25px" class="center">No.</th>
                                            <th width="100px">姓名</th>
                                            <th ng-repeat="x in grp_list">
                                                {{x.name}}
                                            </th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in usr_list | filter:query"
                                            ng-click="peopleDetail($index,x.nickname)"
                                            ng-if="x.show == true">
                                            <td style="text-align: center;">{{$index+1}}</td>
                                            <td>{{ x.nickname}}
                                                <img class="pull-right" src="{{x.headimgurl}}"
                                                     style="height: 20px;width: 20px;border-radius: 50%;">
                                            </td>
                                            <td><input type="checkbox" ng-model="x.check[0]"></td>
                                            <td><input type="checkbox" ng-model="x.check[1]"></td>
                                            <td><input type="checkbox" ng-model="x.check[2]"></td>
                                            <td><input type="checkbox" ng-model="x.check[3]"></td>
                                            <td><input type="checkbox" ng-model="x.check[4]"></td>
                                            <td><input type="checkbox" ng-model="x.check[5]"></td>
                                            <td><input type="checkbox" ng-model="x.check[6]"></td>
                                            <td>
                                                <button type="submit" ng-click="hide($index)">添加</button>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="10">剩余可分配的人员<label
                                                    style="color:red;">{{people_detail_name}}</label>所参与的项目信息
                                            </th>
                                        </tr>
                                        <tr>
                                            <th>项目名称</th>
                                            <th>参与具体任务</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in usr_list[people_detail_index].projectlist | filter:query">
                                            <td class="center">{{x.sub_name}}</td>
                                            <td><label ng-repeat="y in x.task_name">
                                                -{{y.name}}-
                                            </label></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-primary col-xs-2 col-xs-offset-10" data-dismiss="modal">完成
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="modal-form4" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel4"
                     aria-hidden="false">
                    <div class="modal-dialog" style="width:40%;margin-top: 4%;">
                        <div class="modal-content" style="border-radius: 5px;">
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">项目文件</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <div class="table-responsive"
                                     style="overflow-x: auto; overflow-y: auto; height:200px;">
                                    <table class="table table-striped table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th colspan="9"></th>
                                        </tr>
                                        <tr>
                                            <th class="center">No.</th>
                                            <th>文件名</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="x in dl_list.prj_file | filter:query">
                                            <td>{{$index+1}}</td>
                                            <td><a href="{{x.file}}" download="{{x.filename}}">{{x.filename}}</a></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-header">
                                <h2 class="blue bigger" style="text-align: center;">配置文件</h2>
                            </div>
                            <div class="modal-body overflow-visible">
                                <table class="table table-striped table-bordered table-hover">
                                    <thead>
                                    <tr>
                                        <th colspan="9"></th>
                                    </tr>
                                    <tr>
                                        <th class="center">No.</th>
                                        <th>文件名</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="x in dl_list.prj_conf | filter:query">
                                        <td>{{$index+1}}</td>
                                        <td><a href="{{x.file}}" download="{{x.filename}}">{{x.filename}}</a></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="modal-footer" style="text-align: center;">
                                <button class="btn btn-primary col-lg-2 col-lg-offset-10" data-dismiss="modal">完成
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div><!--pagecontent-->
    </div><!-- main-container-inner-->
</div>



